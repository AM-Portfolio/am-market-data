# PostgreSQL Configuration
POSTGRES_PASSWORD: password
POSTGRES_USERNAME: postgres
POSTGRES_URL: jdbc:postgresql://localhost:5456
POSTGRES_DATABASE: portfolio

# InfluxDB Configuration
INFLUXDB_TOKEN: my-super-secret-auth-token
INFLUXDB_ORG: am_investment
INFLUXDB_BUCKET: market_data
INFLUXDB_URL: http://localhost:8087

# Grafana Configuration
GRAFANA_ADMIN_USER: 1109403
GRAFANA_ADMIN_PASSWORD: XXXXXXXXXX

# Kafka Configuration
KAFKA_BOOTSTRAP_SERVERS: localhost:9092
KAFKA_ZOOKEEPER_CONNECT: localhost:2181
KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT
KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
KAFKA_CONSUMER_GROUP_ID: am-market-data-service
KAFKA_CONSUMER_AUTO_OFFSET_RESET: earliest

# Application Configuration
STOKUPATE_TOPIC_NAME: am-stock-price-update
NSE_INDICES_TOPIC_NAME: nse-indices-update
NSE_ETF_TOPIC_NAME: nse-etf-update

MARKET_DATA_MAX_RETRIES: 3
MARKET_DATA_RETRY_DELAY_MS: 1000
MARKET_DATA_THREAD_POOL_SIZE: 5
MARKET_DATA_THREAD_QUEUE_CAPACITY: 10
MARKET_DATA_MAX_AGE_MINUTES: 15

# Upstox Configuration
UPSTOX_ACCESS_TOKEN: eyJ0eXAiOiJKV1QiLCJrZXlfaWQiOiJza192MS4wIiwiYWxnIjoiSFMyNTYifQ.eyJzdWIiOiIyWENSTjgiLCJqdGkiOiI2N2RiNDUwZjNkZGQ3YTZhM2Q0MDdmMmEiLCJpc011bHRpQ2xpZW50IjpmYWxzZSwiaWF0IjoxNzQyNDIzMzExLCJpc3MiOiJ1ZGFwaS1nYXRld2F5LXNlcnZpY2UiLCJleHAiOjE3NDI1MDgwMDB9.trE87ksuZgTY_Isx9bYAxECeStUVgGtWxVNzjtcp0Mk
UPSTOX_API_KEY: 48d1e335-09ad-4dc0-b955-4505c350d10b
UPSTOX_SECRET_KEY: jqre481zf0
UPSTOX_CODE: rNLu2Q 

# NSE API Configuration
NSE_API_BASE_URL: https://www.nseindia.com
NSE_API_MANUAL_COOKIES: "bm_sv=AC6F9B7219D81035146B4E64E0608EAF~YAAQ5wVaaM07I62VAQAA/U7Axxs8DPvK4tW++Vi9qVqMZjR+oEEsvNqKoJID1P0/QOK/rtgEXL8CgYihtksGgHbPE6gI7JJ9IovfFPJlYFwNDVlU1C6llvFUn5TDa/3G1KLcHH/Vok7N1hmkSDqUlvhWqga5/D+uLqK82h6UIEe+IBNMq/oNb1YFT9M1lVlHRlzizerizaeefcdqa1wv8WVaOm22klbu4GlKWo6d5trEO+mnKZ2DdjFel5pdQ+iL2mg=~1; _abck=9C71F61FEBDFB21D6F5DACDBDB0CC5CC~-1~YAAQ5wVaaMw7I62VAQAA207Axw1L4qAo/NAPrfVDdS7TFC5ES43hv35moLg3AqI1BlxzB1m8pCM2y6EpQXA8PyOtmcz4lTCbQzNPiTwJi4EUDYz1igyyHLkWLDZBboisB2g83njr2+KVHs4v8G9//8mlA/5d8whezz81eMwda+0AIapJO4qscXK/NX3XhlHxT40tsSkD4TTOLpwQtsZg4fcxnL5eHUl5Jzu7OTXt65NTX3X6ZIAFG3ovuSkndzvXa19u+a7bOPpCTzLuPe8zP/ek4XEhIODMvh43fr/MCg7tk0KWN+3Z5falmkcCR1WIMxxVEQ76vm7oTO/2NV3oZq6Bqot6P1xaClY0PwMmhIOkdCnqgfvR0JHOR+cTHPNUo589oPLK0tQhfXsIImAmk7Sa+0qAfLHWS09/hOH4of53HRwUKgOqUkqKerbVyFr4MWYj678NNaHkCqZx5SGBAKhanCzvX/cGlGJMJW7axnwMB2OIHxl0omV6sPq2JenGr+4HjGXAJ5l5lFvueF7gdA==~-1~||0||~-1; nsit=uLf_eJAouoKVoEFzyPZKRPzL; AKA_A2=A; bm_mi=E22EFD86423BB35C33CD733016E190D7~YAAQ5wVaaMI7I62VAQAAXk3Axxt4RaeGJhTKmdu8dz36i+l6Itv/XrDhdrhiqb8Lh34ngGlVlj7N02y5DdkcytooTHf0mhDdtsPobLPBrRxmwTMPyDeSuWggVPuyyr+25aFwmQ534cilf9vi6m+zOmLCotnuKv3P4HIuaoqkIiRafWq5a04UT7ztQVW93PFSzfLH6U7jZkrdGfjQsHTg0kOHt4/YY9dPnVo5/vOogYbad1NArWYZT4xgLCuIBqYEqnIo5NqbaDzmZA8sIjNYpTU2maod5aqzCGKYL3JbhV2OJsUCZMcSnoQFs4VX+7fllNLwnM3901UEbviIMoT7K81+QLJU3qa3lgZ0289HfQw=~1; _ga=GA1.1.1270676932.1742813015; _ga_E0LYHCLJY3=GS1.1.1742813014.1.0.1742813014.0.0.0; ak_bmsc=1A81E38006E056E59F6458B6F8EF4E8F~000000000000000000000000000000~YAAQ5wVaaE47I62VAQAAkkLAxxtjgdGbUMJGaXH65UdtTxfH81e5D1TwbIQLyWTo1I0LzzYLT83olbhGWTFF+JVnqTSA5etu+vsTLbdi7NJDyrxY6raAzZuOKSz21QTxWE2fRo9+eOw0aaLL3XxmIyh5UBIwClGs2L89Uyq/QgrdnTbq6fH56McZhU7pGmGh2UqcPGoAuHIsnV/0Aopb4RaFiPMw7nxAmBOI2iM6mTZctr+ix3DITGsJb41nBjl/4jUmrDCWtEyczgnally059gcxM5DVzawagduziRlq+ui2QOvwG8+y53kPpElaOnLp73V1qtAp3cmKTWtabevisEUMAiIF3hOnhhwHcLyp5qksuA+Togl0mU7/a+3oPKL/0eQ0FcLWT0ATg7TUnH15WZ3l8oExvtvd2qe/spSocHSE5yZOQJtDFIxnEFfv1UJTkI=; bm_sz=B78A7E9B9A266D3EEA563029DE666943~YAAQ5wVaaD87I62VAQAAMj7Axxt7ravVr0zDC1FvOJf6oHEBvgWUgr3LITul3Y6eFIyhqLkn7nZKs8lMWZHoLAPuCpq5CqKyG0ZWe8261LGsz4qfv7CAZ1mFIxwkkQO9PKNQSMle/uwusqQl63cSI4gGHnFpJYt1R2ScIIFQ9a+2dafGP0kKnL0dTXoH3rzV6G9zc4PmccsXALVfMTGGWT0KceLq7y/Z6tI6btSimxXnl9KEFiBh9RdBQeq6Sl4UHdTUvFxcJVbcByJr6FF0mv/wJZuTBGugWJBH3C5SiS17FjwwykA0IkOkbcsZjkKV04HnJBHuaSVlmulXUiwqjGzQvMUsmWTcSadfy/kG6RY7GFj22smAvu3HUFkf4I+j3k+Lo+w4QPDA1I2CoxvY~4276791~3618615; nseappid=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcGkubnNlIiwiYXVkIjoiYXBpLm5zZSIsImlhdCI6MTc0MjgxMzAyMiwiZXhwIjoxNzQyODIwMjIyfQ.dPtUc_mfUq--Orgo3tsZ52O9Y9ZxsjVMomhrEFU8tfU"
NSE_API_USE_MANUAL_COOKIES: true

server:
  port: 8084

spring:
  application:
    name: market-data-service
  
  main:
    allow-bean-definition-overriding: true
    
  # Database Configuration
  datasource:
    url: ${POSTGRES_URL}/${POSTGRES_DATABASE}
    username: ${POSTGRES_USERNAME}
    password: ${POSTGRES_PASSWORD}
    driver-class-name: org.postgresql.Driver
    
  # InfluxDB Configuration
  influx:
    url: ${INFLUXDB_URL}
    token: ${INFLUXDB_TOKEN}
    org: ${INFLUXDB_ORG}
    bucket: ${INFLUXDB_BUCKET}
    
  # Kafka Configuration
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP_ID}
      auto-offset-reset: ${KAFKA_CONSUMER_AUTO_OFFSET_RESET}
  
  config:
    import:
      - classpath:isin.yml

  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    show-sql: true

app:
  kafka:
    stock-price-topic: ${STOKUPATE_TOPIC_NAME}
    nse-indices-topic: ${NSE_INDICES_TOPIC_NAME}
    nse-etf-topic: ${NSE_ETF_TOPIC_NAME}
  
  scheduler:
    # Trading hours configuration (from StockDataSchedulerService)
    trading:
      start-time: "00:00"
      end-time: "23:59"
      timezone: "Asia/Kolkata"
      days: "MON-FRI"
    
    # CookieSchedulerService schedules
    cookie:
      enable: true
      refresh: "0 */30 * * * *"  # Cookie refresh every 30 minutes
      retry: "0 */5 * * * *"     # Retry failed cookie refresh every 5 minutes
    
    # MarketDataProcessingService schedules
    market-data:
      # Thread pool configuration from memory
      thread-pool:
        size: ${MARKET_DATA_THREAD_POOL_SIZE}         # Default: 5
        queue-capacity: ${MARKET_DATA_THREAD_QUEUE_CAPACITY} # Default: 10
        prefix: "market-data-"
      
      # Stock data processing (from StockDataSchedulerService)
      stock:
        enable: false
        fetch: "5 */30 * * * *"           # Runs at 5 seconds past every 2 minutes
        validate: "0 */15 * * * *"       # Validate every 15 minutes (max age check)
      
      # ETF data processing (with retry mechanism)
      etf:
        enable: false
        fetch: "0 */30 * * * *"          # Every 5 minutes, trading hours check in service
        validate: "0 */15 * * * *"      # 15min freshness validation
        retry:
          max-attempts: ${MARKET_DATA_MAX_RETRIES}    # Default: 3
          delay-ms: ${MARKET_DATA_RETRY_DELAY_MS}     # Default: 1000ms
      
      # Indices data processing
      indices:
        enable: false
        fetch: "0 */30 * * * *"          # Every 2 minutes, trading hours check in service
        validate: "0 */15 * * * *"      # Data integrity check
      
      # NSE Indices data processing
      nse-indices:
        enable: false
        fetch: "0 */30 * * * *"          # Every 2 minutes, trading hours check in service
        validate: "0 */15 * * * *"      # Data integrity check
    
    # Retry mechanism schedules (3 retries, 1000ms delay)
    retry:
      failed-operations: "0 */1 * * * *"  # Check and retry failed operations
      cleanup: "0 0 * * * *"             # Clean up retry history hourly
    
    # Data management
    data:
      cleanup: "0 0 18 * * *"            # Daily cleanup at 6 PM
      refresh: "0 0 7 * * MON-FRI"       # Refresh at 7 AM weekdays
    
    # Metrics collection (for Micrometer)
    metrics:
      performance: "0 */1 * * * *"        # Collect performance metrics
      health: "0 */1 * * * *"            # Health checks
      counters: "0 */5 * * * *"          # Update success/failure counters
    
    # Health check schedule (every minute)
    health-check: "0 */1 * * * *"
  
  retry:
    max-attempts: ${MARKET_DATA_MAX_RETRIES}
    base-delay-ms: ${MARKET_DATA_RETRY_DELAY_MS}
  
  thread-pool:
    size: ${MARKET_DATA_THREAD_POOL_SIZE}
    queue-capacity: ${MARKET_DATA_THREAD_QUEUE_CAPACITY}
    prefix: "market-data-"
  
  validation:
    max-age-minutes: ${MARKET_DATA_MAX_AGE_MINUTES}

upstox:
  interval: I1
  auth:
    base-url: https://api.upstox.com/v2
    code: ${UPSTOX_CODE}
    api-key: ${UPSTOX_API_KEY}
    secret-key: ${UPSTOX_SECRET_KEY}
    access-token: ${UPSTOX_ACCESS_TOKEN}
    redirect-uri: http://localhost:8080
    authorization-url: https://api-v2.upstox.com/login/authorization/dialog
    token-url: https://api-v2.upstox.com/login/authorization/token
    token-refresh-interval: 3600000
    scope: orders feed portfolio

stock-data-scheduler: false
nse-scraper-scheduler: true
scraper:
  urls:
    - https://www.nseindia.com/

# Logging Configuration
logging:
  level:
    root: INFO
    '[com.am.marketdata]': INFO
    '[com.am.marketdata.scraper]': DEBUG
    '[com.am.marketdata.scheduler]': INFO
    '[com.am.marketdata.service]': INFO
  pattern:
    console: '{"timestamp":"%d{yyyy-MM-dd HH:mm:ss.SSS}","level":"%p","thread":"%t","class":"%c","message":"%m"}%n'